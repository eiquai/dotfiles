# global settings

# set vim as editor, and configure it to not store a copy on disk
#set editor="vim +13 -c 'set nobackup' -c 'set noswapfile' -c 'set nowritebackup' -c 'set tw=72 ft=mail noautoindent'"

set editor="vim +13 -c 'set nobackup' -c 'set noswapfile' -c 'set nowritebackup' -c 'setlocal fo+=aw ft=mail noautoindent'"

unset   imap_passive                                # allow mutt to open new imap connections by itself
set     imap_keepalive  =   300                     # Keep IMAP connection alive
set     imap_check_subscribed   # check all subscribed folders for new mails
set     mail_check      =   120                     # intervall to check for new mails (in seconds)

set     text_flowed     =   yes     # set text_flowed to avoid hart line-breaks
set     mbox_type       =   Maildir # not sure, if this is needed for a pure mutt setup

set     date_format         =   "%a, %d. %b %H:%M"


set     xterm_set_titles    =   yes


# use only safe SSL connections:
# see https://gist.github.com/bnagy/8914f712f689cc01c267 for details
# SECURITY
set     ssl_force_tls       =   yes
set     ssl_starttls        =   yes
set     ssl_use_sslv3       =   no
set     ssl_use_sslv2       =   no
set     ssl_use_tlsv1       =   no #this setting is problematic for use with my university mail account
set     ssl_use_tlsv1_1     =   no
set     ssl_use_tlsv1_2     =   yes
set     ssl_verify_dates    =   yes
set     ssl_verify_host     =   yes

# TODO
# regarding security, these settings need to be reviewed once everything is set up
# because it means we keep a local unencrypted copy of all e-mails.
# and I don't want that
# Solution is probably something like keeping inbox as empty as possible and restrict loading to inbox
#set     message_cachedir    =  "~/.cache/mutt"      # store messages locally
set     header_cache    =   ~/.cache/mutt           # store message header locally

# TODO
# regarding security, an alias file is a really really bad idea
# so I need to think about that. But for now, let's keep an alias file
# ideas: encrypted alias file (which would mean that alias are static, as adding an alias requires manual work
set     alias_file          =   ~/.mutt/alias       # we want alias for names
source  ~/.mutt/alias       # so read alias file on startup
set     reverse_alias                               # resolv mail adresses for list view and show alias if existing

# to make mutt even more secure, handle certificates seperately
unset   ssl_usesystemcerts
set     certificate_file    =   ~/.mutt/mailcerts

# TODO
# handle passwords in a secure (but convenient) way
# get passwords from gpg-encrypted file ~/.my-pwds.gpg
source  "gpg2 -dq $HOME/.my-pwds.gpg |"

# THIS MAY ONLY BE USED TEMPORARILY FOR DEBUGGING!
#source  "cat $HOME/.my-pwds |"

# set charset to UTF8 for all outgoing mails
set send_charset    =   "utf-8"

# we use one config-file per account located in ~/.mutt/[accountname].conf
# and when we switch accounts, we want to source the right config, to make sure that mutt keeps mail accounts separated
#folder-hook 'timon.schroeder@posteo.de'      'source ~/.mutt/posteo.conf'
#folder-hook 'timon.schr@gmail.com'           'source ~/.mutt/gmail.conf'
#folder-hook 'timon.schroeder@uni-potsdam.de' 'source ~/.mutt/university.conf'
folder-hook 'posteo.de'      'source ~/.mutt/posteo.conf'
folder-hook 'gmail.com'      'source ~/.mutt/gmail.conf'
folder-hook 'uni-potsdam.de' 'source ~/.mutt/university.conf'

# settings regarding HTML-Mails
auto_view   text/html

# switch to posteo account after startup
source ~/.mutt/posteo.conf
#source ~/.mutt/gmail.conf
#source ~/.mutt/university.conf

# Key bindings / shortcuts
#bind index x imap-fetch-mail # shortcut for fetching mail

# MACROS
#macro index,pager <f2> '<sync-mailbox><enter-command>source ~/.mutt/gmail.conf<enter><change-folder>!<enter>'
#

macro index <f1> "<enter-command>less /usr/share/doc/mutt/manual.txt<enter>" "test"

macro index <f2> '<sync-mailbox><enter-command>source ~/.mutt/gmail.conf<enter><change-folder>!<enter>' "switch to gmail"

macro index <f3> '<sync-mailbox><enter-command>source ~/.mutt/posteo.conf<enter><change-folder>!<enter>' "switch to posteo"
macro index <f4> '<sync-mailbox><enter-command>source ~/.mutt/university.conf<enter><change-folder>!<enter>' "switch to university"

macro pager \Cb <pipe-entry>'urlview'<enter> 'Follow links with urlview'

# bind commands to keys so that we can disable commands that may reveal passphrases
#bind generic,alias,attach,browser,editor,index,compose,pager,pgp,postpone ':' noop

# VIM like keybindings:
bind index  j       next-entry
bind index  k       previous-entry
bind index  J       next-thread 
bind index  K       previous-thread

bind index  /       search
bind index  ?       search-reverse
bind index  n       search-next
bind index  N       search-opposite

bind index  g       first-entry
bind index  G       last-entry

bind index  l       collapse-thread
bind index  z       collapse-all

bind index  r       reply
bind index  R       group-reply
bind index  L       list-reply

bind index  <tab>   sync-mailbox

bind index h        limit

# as '?' is used for searching we need to replace key binding for help
bind index H      help

# Start with threads collapsed and most recent thread selected
push <collapse-all><last-entry>

# key bindings for pager
bind pager j next-line
bind pager k previous-line
bind pager <down>   next-line
bind pager <up>     previous-line

bind pager /    search
bind pager ?    search-reverse

bind pager n    search-next
bind pager N    search-opposite

bind pager  g   top
bind pager  G   bottom

# as '?' is used for searching we need to replace key binding for help
bind pager H  help

bind attach,index,pager \CD next-page
bind attach,index,pager \CU previous-page


# COLORS
color   header  brightblack default "^(from|subject):'
color   body    cyan        default "[-a-z_0-9.+]+@[-a-z_0-9.]+"

uncolor index   *
color   index   white       default ~Q  # answered
color   index   green       default ~F  # marked
color   index   red         default ~N  # new
color   index   brightred   default ~O  # unread
color   index   magenta     default ~T  # tagged
color   index   yellow      default ~D  # deleted

